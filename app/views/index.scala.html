@import model.Evento
@import model.EventosDia

@(eventosAgora: Seq[Evento],
  eventosHoje: Seq[Evento],
  eventosDia: Seq[EventosDia],
  atualizadoEm: String,
  proxEventoMiliSec: Option[Long],
  jsonld: String,
  tags: Seq[(String, String)])

@colorByTag(tag: String) = {@tags.find(t => t._1 == tag).map(_._2).getOrElse("#f103c9")}

@displayEvento(evento: Evento, full: Boolean = false, agora: Boolean = false) = {
<div class="testi-item" data-jplist-item>
  <div class="testi-meta-inner d-flex" collapse-control="@evento.generatedId">
    <div class="testi-img mr-2">
      @if(evento.thumbnailUrl.isDefined) {
        <img class="thumbnail" src='@evento.thumbnailUrl.get'>
      } else {
        <img class="thumbnail" src='@routes.Assets.versioned("img/microfone.jpg")'>
      }
    </div>
    <div class="testi-details">
      <p class="testi-destaque mb-0 searchable">
        @evento.nome
        @if(evento.destaque) {
          <span class="icon-star"></span>
        }
        @if(evento.encerrado.getOrElse(false)){
          <i>(Encerrado)</i>
        }

      </p>      
      @if(evento.info.nonEmpty) {
      <p class="testi-info mb-0 searchable">
        @evento.info
      </p>
      }
      @for(tag <- evento.tags){
        @if(tag == "Música"){
          <span class="badge badge-live @tag" hidden>@tag</span>
        } else {
          <span class="badge badge-live @tag" style='background-color: @colorByTag(tag)'>@tag</span>
        }
      }
      <p class="testi-desc mb-0">
        @evento.horarioFmt
        <!-- <span class="icon-caret-square-o-down"></span>
        <span class="icon-caret-square-o-up"></span> -->
      </p>
    </div>
  </div>
  <div class="collapse multi-collapse" id='@evento.generatedId'>
    <div class="card card-body bg-transparent">
      <div class="icones-previa">
        @if(evento.youtubeData.flatMap(_.embeddable).contains(true)){
          <button type="button" class="button-clear" onclick='playYoutubeVideoId("@evento.youtubeData.flatMap(_.videoId).get")'>
            <span class="icon icon-play-circle"></span>
          </button>
        }
        @if(evento.linkLive.isDefined) {
          <a class="icone" rel="nofollow" href="@evento.linkLive.get" target="_blank">
            <span class="icon @evento.iconeLive"></span>
          </a>
        }
        @if(evento.instagramProfile.isDefined && (!agora || (agora && evento.youtubeData.flatMap(_.link).isDefined)))  {
          <a class="icone" rel="nofollow" href="@evento.instagramProfile.get" target="_blank">
            <span class="icon icon-instagram"></span>
          </a>
        }
        @if(evento.outroLink.isDefined && !agora)  {
          <a class="icone" rel="nofollow" href="@evento.outroLink.get" target="_blank">
            <span class="icon icon-external-link-square"></span>
          </a>
        }
      </div>
      
      <span class="h6">
        Compartilhar live
        <a class="link-no-decoration" href='https://wa.me/?text=@evento.urlEncodedShare' target="_blank">
          <span class="icon-whatsapp"></span>
        </a>
        <a class="link-no-decoration" href='https://twitter.com/intent/tweet?text=@evento.urlEncodedShare' target="_blank">
          <span class="icon-twitter"></span>
        </a>
        <a class="link-no-decoration" href='https://www.facebook.com/sharer/sharer.php?u=livesdodia.com.br&quote=@evento.urlEncodedShareFacebook' target="_blank">
          <span class="icon-facebook-square"></span>
        </a>
      </span>
    </div>
  </div>
</div>
}

@tituloHoje() = {
  @if(eventosAgora.nonEmpty) {
    Em breve
  } else {
    Hoje
  }
}

@*
*<!--@tagSelected(tag: String) = {@(tag.equals("Música") && eventosAgora.flatMap(_.tags).contains("Música"))}-->
*@

@tagSelected(tag: String) = {false}


@buscanaoencontrada() = {
  <div class="testi-item busca-nao-encontrada" style="display: none">
    Live não encontrada nessa seção, refaça a busca ou <a href="/incluir">cadastre uma nova</a>.
  </div>
}

@base {
  <div  class="yt-player">
    <div id="player"></div>
    <button type="button" class="yt-close-button" onclick="closeVideo()">
      <span class="icon-close"></span>
    </button>
  </div>

  <script>
    // 2. This code loads the IFrame Player API code asynchronously.
    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // 3. This function creates an <iframe> (and YouTube player)
    //    after the API code downloads.
    var player;
    // function onYouTubeIframeAPIReady() {
      // player = new YT.Player('player', {
      //   width: '100%',
      //   videoId: 'M7lc1UVf-VE',
      //   events: {
      //     'onReady': onPlayerReady,
      //     'onStateChange': onPlayerStateChange
      //   }
      // });
    // }

    function hideElementsPlayVideo() {
      $('.rectangle-1').hide();
      $('.rectangle-2').hide();
      $('.rectangle-transparent-1').hide();
      $('.rectangle-transparent-2').hide();
      $('.header-container').css('background', 'transparent').removeClass('shadow');
      $('section').first().removeClass('maybe-first-section');
    }

    function showElementsPlayVideo() {
      $('.rectangle-1').show();
      $('.rectangle-2').show();
      $('.rectangle-transparent-1').show();
      $('.rectangle-transparent-2').show();
      $('.header-container').css('background', 'linear-gradient(to right, #333399, #ff00cc)').addClass('shadow');
      $('section').first().addClass('maybe-first-section');
    }

    function closeVideo() {
      showElementsPlayVideo();
      player.destroy();
      player = undefined;
    }

    function playYoutubeVideoId(videoId) {
      hideElementsPlayVideo();
      if (!player) {
        player = new YT.Player('player', {
        videoId: videoId,
        width: '100%',
        events: {
          'onReady': onPlayerReady
        }
      });
      } else {
        player.loadVideoById(videoId);
      }
    }

    // 4. The API will call this function when the video player is ready.
    function onPlayerReady(event) {
      event.target.playVideo();
    }

  </script>

  <!-- INICIADAS -->
  @if(eventosAgora.nonEmpty) {
  <section class="maybe-first-section section-padding bg-white">
    <div class="container">
      <div class="section-content shadow destaque-box" data-aos="fade-up">
        <div class="heading-section text-center">
          <h2>
            Já começou
          </h2>
        </div>
        <div class="row">
          <div class="testi-content search-not-found-container" data-jplist-group="search-group">
            @for(evento <- eventosAgora) {
              @displayEvento(evento, true, true)
            }
            @buscanaoencontrada
          </div>
        </div>
      </div>
    </div>
  </section>
  }
  <!-- FIM INICIADA -->

  @if(eventosHoje.nonEmpty) {
  <section class="maybe-first-section section-padding bg-fixed bg-white">
    <div class="container">
      <div class="section-content shadow destaque-box" data-aos="fade-up">
        <div class="heading-section text-center">
          <h2>
            @tituloHoje()
          </h2>
        </div>
        <div class="row">
          <div class="testi-content search-not-found-container" data-jplist-group="search-group">
            @for(evento <- eventosHoje) {
              @displayEvento(evento, true)
            }
            @buscanaoencontrada
          </div>
        </div>
      </div>
    </div>
  </section>
  }

  <div class="tags">
    <button type="button" data-jplist-control="buttons-text-filter" data-path=".badge" data-group="search-group"
            data-mode="radio" data-selected="true" data-text="" class="badge badge-live" data-name="buttons-text-filter">
      Todos
    </button>
    @for(tag <- tags) {
      <button type="button"
              data-jplist-control="buttons-text-filter" data-path=".badge" data-group="search-group"
              data-mode="radio" data-text="@tag._1" class="badge badge-live" data-name="buttons-text-filter"
              data-selected='@tagSelected(tag._1)'
              style='background-color: @tag._2'
              >
        @tag._1
      </button>
    }
  </div>

  <section id="client" class="overlay bg-fixed" style='background-image: url(@routes.Assets.versioned("img/bg.jpg"));'>
    <div class="container">
      <div class="section-content" data-aos="fade-up">
        <div class="row">
          <div class="col-md-12">
            <div class="title-wrap">
              <h2>Programação</h2>
            </div>
          </div>
          <!-- Client Holder -->
          <div class="col-md-12 client-holder search-not-found-container">
            @buscanaoencontrada
            <div class="client-slider">
              @for(item <- eventosDia){
              <div class="shadow dia-box">
                <div class="heading-section text-center">
                  <p>
                    @item.diaProgramacaoFmt
                  </p>
                  <h2 class="mb-4">
                    @item.diaFmt
                  </h2>
                </div>
                <div data-jplist-group="search-group">
                  @for(evento <- item.eventos){
                    @displayEvento(evento, false)
                  }
                </div>
              </div>
              }
            </div>
            <!-- End of Client Holder -->
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <section class="bg-white">
    <div class="container">
      <div class="section-content">
        <div class="title-wrap">
          <h2 class="section-title">
            Alguma live ainda <b>não está na nossa agenda?</b> Você pode cadastrar <a class="" href="/incluir">aqui</a>.
          </h2>
          <p class="section-sub-title">
            Valorize o artista, assista nos canais oficiais
          </p>
        </div>
      </div>
    </div>
  </section>

  @if(proxEventoMiliSec.isDefined){
    <script type="text/javascript">
      setTimeout(function(){
        location.reload(true);
      },@proxEventoMiliSec.get)
    </script>
  }

}(Some(jsonld), true)